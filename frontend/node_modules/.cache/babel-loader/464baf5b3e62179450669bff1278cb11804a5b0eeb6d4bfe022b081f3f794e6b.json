{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { toast } from \"react-hot-toast\";\nimport { copyToClipboard } from \"../utils/clipboard\";\nimport { useOrchestration } from \"./useOrchestration\";\nimport { useWebSocket } from \"./useWebSocket\";\nimport { crewAPI } from \"../services/api\";\nimport { useAuth } from \"../contexts/AuthContext\";\n\n/**\n * ë©€í‹°-ì—ì´ì „íŠ¸ AI ì‘ë‹µì„ íŒŒì‹±í•˜ê³  UIì— ë§ëŠ” ë©”ì‹œì§€ ê°ì²´ë¡œ ë³€í™˜\n */\nconst processMultiAgentResponse = result => {\n  if (!result) {\n    console.error(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‘ë‹µ ì˜¤ë¥˜: ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤\", result);\n    return {\n      id: \"error-\" + Date.now(),\n      type: \"assistant\",\n      content: \"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n      timestamp: new Date().toISOString(),\n      isError: true\n    };\n  }\n\n  // ë©€í‹°-ì—ì´ì „íŠ¸ ê²°ê³¼ êµ¬ì„±\n  const agentResults = result.agentResults || {};\n  const finalTitles = result.finalTitles || {};\n  const tokenUsage = result.tokenUsage || 0;\n\n  // ì—ì´ì „íŠ¸ë³„ ê²°ê³¼ë¥¼ í¬ë§·íŒ…\n  const agentSummary = Object.keys(agentResults).map(agentType => {\n    const agentResult = agentResults[agentType];\n    const titles = finalTitles[agentType] || [];\n    return {\n      agentType,\n      agentName: getAgentName(agentType),\n      result: (agentResult === null || agentResult === void 0 ? void 0 : agentResult.content) || \"ê²°ê³¼ ì—†ìŒ\",\n      titles: titles,\n      tokenCount: (agentResult === null || agentResult === void 0 ? void 0 : agentResult.tokenCount) || 0\n    };\n  });\n\n  // ì „ì²´ ì œëª© ëª©ë¡ ìƒì„±\n  const allTitles = Object.values(finalTitles).flat();\n  return {\n    id: \"multi-agent-\" + Date.now(),\n    type: \"assistant\",\n    content: formatMultiAgentContent(agentSummary, allTitles),\n    timestamp: new Date(),\n    // ë©€í‹°-ì—ì´ì „íŠ¸ íŠ¹í™” ë°ì´í„°\n    isMultiAgent: true,\n    agentResults: agentSummary,\n    allTitles: allTitles,\n    tokenUsage: tokenUsage\n  };\n};\n\n/**\n * ì—ì´ì „íŠ¸ íƒ€ì…ì„ í•œêµ­ì–´ ì´ë¦„ìœ¼ë¡œ ë³€í™˜\n */\nconst getAgentName = agentType => {\n  const agentNames = {\n    journalism: \"ğŸ“° ì €ë„ë¦¬ì¦˜ ì¶©ì‹¤í˜•\",\n    balanced: \"âš–ï¸ ê· í˜•ì¡íŒ í›„í‚¹í˜•\",\n    click: \"ğŸ¯ í´ë¦­ìœ ë„í˜•\",\n    seo: \"ğŸ” SEO/AEO ìµœì í™”í˜•\",\n    social: \"ğŸ“± ì†Œì…œë¯¸ë””ì–´ ê³µìœ í˜•\"\n  };\n  return agentNames[agentType] || `ğŸ¤– ${agentType}`;\n};\n\n/**\n * ë©€í‹°-ì—ì´ì „íŠ¸ ê²°ê³¼ë¥¼ UI í‘œì‹œìš© í…ìŠ¤íŠ¸ë¡œ í¬ë§·íŒ…\n */\nconst formatMultiAgentContent = (agentSummary, allTitles) => {\n  let content = \"ğŸš€ **ë©€í‹°-ì—ì´ì „íŠ¸ ë¶„ì„ ì™„ë£Œ**\\n\\n\";\n\n  // ì „ì²´ ì œëª© ìš”ì•½\n  if (allTitles.length > 0) {\n    content += \"ğŸ“‹ **ìƒì„±ëœ ì œëª© ëª©ë¡:**\\n\";\n    allTitles.forEach((title, index) => {\n      content += `${index + 1}. ${title}\\n`;\n    });\n    content += \"\\n\";\n  }\n\n  // ì—ì´ì „íŠ¸ë³„ ìƒì„¸ ê²°ê³¼\n  content += \"ğŸ” **ì—ì´ì „íŠ¸ë³„ ë¶„ì„ ê²°ê³¼:**\\n\\n\";\n  agentSummary.forEach(agent => {\n    content += `### ${agent.agentName}\\n`;\n    if (agent.titles.length > 0) {\n      content += \"**ìƒì„± ì œëª©:**\\n\";\n      agent.titles.forEach(title => {\n        content += `â€¢ ${title}\\n`;\n      });\n    }\n    content += `**í† í° ì‚¬ìš©ëŸ‰:** ${agent.tokenCount}ê°œ\\n\\n`;\n  });\n  return content;\n};\n\n/**\n * ì±„íŒ… ê¸°ëŠ¥ì„ ìœ„í•œ ì»¤ìŠ¤í…€ í›…\n * @param {string} projectId - í”„ë¡œì íŠ¸ ID\n * @param {string} projectName - í”„ë¡œì íŠ¸ ì´ë¦„\n * @param {Array} promptCards - í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ë°°ì—´\n * @returns {Object} - ì±„íŒ… ê´€ë ¨ ìƒíƒœì™€ í•¨ìˆ˜ë“¤\n */\nexport const useChat = (projectId, projectName, promptCards = [], conversationId = null) => {\n  _s();\n  const {\n    user\n  } = useAuth(); // Add user from AuthContext\n\n  // ë””ë²„ê¹… ë¡œê·¸ (ì²« ë²ˆì§¸ ë Œë”ë§ì—ë§Œ)\n  const isFirstRender = useRef(true);\n  if (isFirstRender.current) {\n    console.log('useChat ì´ˆê¸°í™”:', {\n      projectId,\n      projectName,\n      promptCardsLength: promptCards === null || promptCards === void 0 ? void 0 : promptCards.length,\n      conversationId,\n      userId: user === null || user === void 0 ? void 0 : user.id\n    });\n    isFirstRender.current = false;\n  }\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [copiedMessage, setCopiedMessage] = useState(null);\n  const [canSendMessage, setCanSendMessage] = useState(true);\n  const [inputHeight, setInputHeight] = useState(24); // ë™ì  ë†’ì´ ê´€ë¦¬\n  const [selectedModel, setSelectedModel] = useState(\"anthropic.claude-3-5-sonnet-20241022-v2:0\");\n  const streamingMessageIdRef = useRef(null);\n  const currentWebSocketRef = useRef(null);\n  const currentExecutionIdRef = useRef(null);\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n\n  // ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ìƒíƒœ ì¶”ì \n  const [isUserScrolling, setIsUserScrolling] = useState(false);\n  const scrollContainerRef = useRef(null);\n  const lastScrollTopRef = useRef(0);\n  const {\n    isExecuting: isGenerating,\n    isStreaming,\n    executeOrchestration,\n    resetOrchestration\n  } = useOrchestration(projectId);\n\n  // WebSocket í›… ì¶”ê°€\n  const {\n    isConnected: wsConnected,\n    isConnecting: wsConnecting,\n    error: wsError,\n    startStreaming: wsStartStreaming,\n    addMessageListener,\n    removeMessageListener\n  } = useWebSocket(projectId);\n\n  // ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì • - projectId ë³€ê²½ì‹œì—ë§Œ ì´ˆê¸°í™”\n  useEffect(() => {\n    setMessages([]); // ë¹ˆ ë°°ì—´ë¡œ ì‹œì‘\n  }, [projectId]); // projectName ëŒ€ì‹  projectId ì‚¬ìš©\n\n  // ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ê°ì§€ í•¨ìˆ˜\n  const handleScroll = useCallback(() => {\n    if (!scrollContainerRef.current) return;\n    const container = scrollContainerRef.current;\n    const currentScrollTop = container.scrollTop;\n    const maxScrollTop = container.scrollHeight - container.clientHeight;\n\n    // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤í–ˆëŠ”ì§€ ê°ì§€\n    if (Math.abs(currentScrollTop - lastScrollTopRef.current) > 2) {\n      const isAtBottom = currentScrollTop >= maxScrollTop - 20;\n\n      // í•˜ë‹¨ì— ìˆì„ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤ í—ˆìš©, ê·¸ ì™¸ëŠ” ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ëª¨ë“œ\n      setIsUserScrolling(!isAtBottom);\n    }\n    lastScrollTopRef.current = currentScrollTop;\n  }, []);\n  const scrollToBottom = useCallback(() => {\n    // ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤\n    if (!isUserScrolling && messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    }\n  }, [isUserScrolling]);\n\n  // ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ (ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  // WebSocket ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •\n  useEffect(() => {\n    const handleWebSocketMessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        console.log(\"WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :\", data);\n        const currentStreamingId = streamingMessageIdRef.current;\n        switch (data.type) {\n          case \"stream_start\":\n            console.log(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘\");\n            break;\n          case \"progress\":\n            // ì§„í–‰ ìƒí™© ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  UI ì—…ë°ì´íŠ¸ëŠ” ì œê±°\n            console.log(`ì§„í–‰ ìƒí™©: ${data.step} (${data.progress}%)`);\n            break;\n          case \"stream_chunk\":\n            if (currentStreamingId) {\n              setMessages(prev => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n                console.log(\"ìŠ¤íŠ¸ë¦¼ ì²­í¬ ì²˜ë¦¬:\", {\n                  currentStreamingId,\n                  streamingMsgIndex,\n                  messagesLength: prev.length,\n                  content: data.content\n                });\n                if (streamingMsgIndex !== -1) {\n                  // ê¸°ì¡´ ë‚´ìš©ì— ìƒˆ ì²­í¬ ì¶”ê°€\n                  const currentContent = updatedMessages[streamingMsgIndex].content || \"\";\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content: currentContent + data.content,\n                    isLoading: true,\n                    isStreaming: true\n                  };\n                  console.log(\"ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ë¨:\", updatedMessages[streamingMsgIndex]);\n                } else {\n                  console.log(\"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ë©”ì‹œì§€ IDë“¤:\", prev.map(m => m.id));\n                }\n                return updatedMessages;\n              });\n              // ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì—ëŠ” ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤\n              if (!isUserScrolling) {\n                scrollToBottom();\n              }\n            } else {\n              console.log(\"currentStreamingIdê°€ nullì„\");\n            }\n            break;\n          case \"stream_complete\":\n            if (currentStreamingId) {\n              setMessages(prev => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n                if (streamingMsgIndex !== -1) {\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content: data.fullContent,\n                    isLoading: false,\n                    isStreaming: false,\n                    timestamp: new Date().toISOString()\n                  };\n                }\n                return updatedMessages;\n              });\n              streamingMessageIdRef.current = null;\n              scrollToBottom();\n            }\n            break;\n          case \"error\":\n            console.error(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì˜¤ë¥˜:\", data.message);\n            if (currentStreamingId) {\n              setMessages(prev => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n                if (streamingMsgIndex !== -1) {\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content: \"ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n                    isLoading: false,\n                    isStreaming: false,\n                    isError: true,\n                    timestamp: new Date().toISOString()\n                  };\n                }\n                return updatedMessages;\n              });\n              streamingMessageIdRef.current = null;\n            }\n            toast.error(data.message);\n            break;\n          default:\n            console.log(\"ì•Œ ìˆ˜ ì—†ëŠ” WebSocket ë©”ì‹œì§€ íƒ€ì…:\", data.type);\n        }\n      } catch (error) {\n        console.error(\"WebSocket ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:\", error);\n      }\n    };\n    if (wsConnected) {\n      addMessageListener(handleWebSocketMessage);\n    }\n    return () => {\n      if (wsConnected) {\n        removeMessageListener(handleWebSocketMessage);\n      }\n    };\n  }, [wsConnected, addMessageListener, removeMessageListener, scrollToBottom]);\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬ í•¨ìˆ˜\n   */\n  const handleStreamingResponse = useCallback((chunk, metadata) => {\n    const currentStreamingId = streamingMessageIdRef.current;\n    console.log(\"ì²­í¬ ìˆ˜ì‹ :\", chunk, \"ìŠ¤íŠ¸ë¦¬ë° ID:\", currentStreamingId);\n    if (!currentStreamingId) {\n      console.error(\"ìŠ¤íŠ¸ë¦¬ë° IDê°€ ì—†ìŠµë‹ˆë‹¤!\");\n      return;\n    }\n    setMessages(prev => {\n      const updatedMessages = [...prev];\n      const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n      if (streamingMsgIndex !== -1) {\n        // ê¸°ì¡´ ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸\n        updatedMessages[streamingMsgIndex] = {\n          ...updatedMessages[streamingMsgIndex],\n          content: updatedMessages[streamingMsgIndex].content + chunk,\n          isLoading: true,\n          isStreaming: true\n        };\n        console.log(\"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ì„±ê³µ:\", updatedMessages[streamingMsgIndex].content);\n      } else {\n        console.error(\"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:\", currentStreamingId);\n      }\n      return updatedMessages;\n    });\n\n    // ìŠ¤í¬ë¡¤ ì¡°ì • (ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)\n    if (!isUserScrolling) {\n      scrollToBottom();\n    }\n  }, [scrollToBottom, isUserScrolling]);\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n   */\n  const handleStreamingComplete = useCallback(result => {\n    const currentStreamingId = streamingMessageIdRef.current;\n    console.log(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ:\", result, \"ìŠ¤íŠ¸ë¦¬ë° ID:\", currentStreamingId);\n    if (!currentStreamingId) {\n      console.error(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì¤‘ IDê°€ ì—†ìŠµë‹ˆë‹¤!\");\n      return;\n    }\n    setMessages(prev => {\n      const updatedMessages = [...prev];\n      const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n      if (streamingMsgIndex !== -1) {\n        // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì™„ë£Œ ì²˜ë¦¬\n        updatedMessages[streamingMsgIndex] = {\n          ...updatedMessages[streamingMsgIndex],\n          content: result.result,\n          isLoading: false,\n          isStreaming: false,\n          performance_metrics: result.performance_metrics,\n          model_info: result.model_info,\n          timestamp: new Date().toISOString()\n        };\n        console.log(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì„±ê³µ:\", updatedMessages[streamingMsgIndex].content);\n      } else {\n        console.error(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:\", currentStreamingId);\n      }\n      return updatedMessages;\n    });\n\n    // ìŠ¤íŠ¸ë¦¬ë° ID ì´ˆê¸°í™”\n    streamingMessageIdRef.current = null;\n\n    // ì…ë ¥ í™œì„±í™”\n    console.log(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ - ì…ë ¥ í™œì„±í™”\");\n    setCanSendMessage(true);\n\n    // ìŠ¤í¬ë¡¤ ì¡°ì • (ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œì—ëŠ” í•­ìƒ í•˜ë‹¨ìœ¼ë¡œ)\n    scrollToBottom();\n  }, [scrollToBottom]);\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ í•¨ìˆ˜\n   */\n  const handleStopGeneration = useCallback(() => {\n    console.log(\"ìƒì„± ì¤‘ë‹¨ ìš”ì²­\");\n\n    // WebSocket ì—°ê²° ì¢…ë£Œ\n    if (currentWebSocketRef.current) {\n      currentWebSocketRef.current.close();\n      currentWebSocketRef.current = null;\n    }\n\n    // í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… ì¤‘ë‹¨\n    if (currentExecutionIdRef.current) {\n      // ì—¬ê¸°ì„œ ì‹¤ì œ API í˜¸ì¶œ ì¤‘ë‹¨ ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\n      currentExecutionIdRef.current = null;\n    }\n\n    // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ìƒíƒœ ì—…ë°ì´íŠ¸\n    const currentStreamingId = streamingMessageIdRef.current;\n    if (currentStreamingId) {\n      setMessages(prev => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === currentStreamingId);\n        if (streamingMsgIndex !== -1) {\n          updatedMessages[streamingMsgIndex] = {\n            ...updatedMessages[streamingMsgIndex],\n            content: updatedMessages[streamingMsgIndex].content + \"\\n\\n[ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤]\",\n            isLoading: false,\n            isStreaming: false,\n            timestamp: new Date().toISOString()\n          };\n        }\n        return updatedMessages;\n      });\n      streamingMessageIdRef.current = null;\n    }\n\n    // ì…ë ¥ ê°€ëŠ¥ ìƒíƒœë¡œ ë³µì›\n    setCanSendMessage(true);\n\n    // orchestration ìƒíƒœ ë¦¬ì…‹\n    resetOrchestration();\n    toast.success(\"ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤\");\n  }, [resetOrchestration]);\n\n  /**\n   * ì…ë ¥ì°½ ë†’ì´ ìë™ ì¡°ì ˆ\n   */\n  const adjustInputHeight = useCallback(value => {\n    if (!value.trim()) {\n      setInputHeight(24); // ê¸°ë³¸ ë†’ì´\n      return;\n    }\n\n    // ì¤„ ìˆ˜ ê³„ì‚° (ëŒ€ëµì )\n    const lines = value.split('\\n').length;\n    const charBasedLines = Math.ceil(value.length / 80); // 80ìë‹¹ 1ì¤„ë¡œ ì¶”ì •\n    const estimatedLines = Math.max(lines, charBasedLines);\n\n    // ë†’ì´ ê³„ì‚° (lineHeight: 1.4, fontSize: 16px)\n    let calculatedHeight;\n    if (estimatedLines <= 3) {\n      calculatedHeight = 24 + (estimatedLines - 1) * 22; // ê¸°ë³¸ + ì¶”ê°€ ì¤„\n    } else if (estimatedLines <= 10) {\n      calculatedHeight = 150 + (estimatedLines - 6) * 15; // ì¤‘ê°„ ë²”ìœ„\n    } else {\n      calculatedHeight = Math.min(400, 150 + (estimatedLines - 6) * 12); // ìµœëŒ€ 400px\n    }\n    setInputHeight(Math.max(24, calculatedHeight));\n  }, []);\n\n  /**\n   * ì…ë ¥ê°’ ë³€ê²½ ì²˜ë¦¬\n   */\n  const handleInputChange = useCallback(value => {\n    setInputValue(value);\n    adjustInputHeight(value);\n  }, [adjustInputHeight]);\n\n  /**\n   * ë©”ì‹œì§€ ì „ì†¡\n   */\n  const handleSendMessage = useCallback(async () => {\n    console.log(\"í•´ë“¤ ì „ì†¡ í˜¸ì¶œ:\", {\n      inputValue: inputValue.trim(),\n      isGenerating,\n      canSendMessage\n    });\n    if (!inputValue.trim() || isGenerating) {\n      console.log(\"ì „ì†¡ ì¤‘ë‹¨: ì¡°ê±´ ë¶€ì¡±\");\n      return;\n    }\n\n    // ì…ë ¥ ë¹„í™œì„±í™”\n    console.log(\"ì…ë ¥ ë¹„í™œì„±í™”\");\n    setCanSendMessage(false);\n    const userMessage = {\n      id: \"user-\" + Date.now(),\n      type: \"user\",\n      content: inputValue.trim(),\n      timestamp: new Date().toISOString()\n    };\n\n    // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ID ìƒì„±\n    const streamMsgId = \"streaming-\" + Date.now();\n    streamingMessageIdRef.current = streamMsgId;\n    console.log(\"ìƒˆ ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ID ìƒì„±:\", streamMsgId);\n\n    // ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ìœ„í•œ ì´ˆê¸° ë©”ì‹œì§€\n    const streamingMessage = {\n      id: streamMsgId,\n      type: \"assistant\",\n      content: \"\",\n      timestamp: new Date().toISOString(),\n      isLoading: true,\n      isStreaming: true\n    };\n    setMessages(prev => [...prev, userMessage, streamingMessage]);\n    setInputValue(\"\");\n    setInputHeight(24); // ì…ë ¥ì°½ ë†’ì´ ì´ˆê¸°í™”\n\n    // ê¸°ì¡´ ë©”ì‹œì§€ + í˜„ì¬ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í¬í•¨í•œ ëŒ€í™” íˆìŠ¤í† ë¦¬ ìƒì„±\n    const allMessages = [...messages, userMessage];\n    const chatHistory = allMessages.filter(msg => !msg.isLoading && !msg.isError && !msg.isStreaming).map(msg => ({\n      role: msg.type === \"user\" ? \"user\" : \"assistant\",\n      content: msg.content\n    }));\n\n    // ìµœëŒ€ ëŒ€í™” ê¸°ì–µ ì„¤ì • (ìµœê·¼ 50ê°œ ë©”ì‹œì§€ë¡œ ìµœëŒ€ ë©”ëª¨ë¦¬ ìœ ì§€)\n    const maxHistoryLength = 50;\n    const trimmedChatHistory = chatHistory.slice(-maxHistoryLength);\n    console.log(\"ëŒ€í™” íˆìŠ¤í† ë¦¬ ìƒì„±:\", {\n      totalMessages: allMessages.length,\n      fullHistoryLength: chatHistory.length,\n      trimmedHistoryLength: trimmedChatHistory.length,\n      maxHistoryLength: maxHistoryLength,\n      recentHistory: trimmedChatHistory.slice(-6) // ìµœê·¼ 6ê°œë§Œ ë¡œê·¸ì— í‘œì‹œ\n    });\n    try {\n      // í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ì •ë³´ ì¶”ê°€ - í™œì„±í™”ëœ ì¹´ë“œë§Œ í•„í„°ë§í•˜ê³  ë°±ì—”ë“œ í˜•ì‹ì— ë§ê²Œ ë³€í™˜\n      const safePromptCards = Array.isArray(promptCards) ? promptCards : [];\n      const activePromptCards = safePromptCards.filter(card => card.isActive !== false && card.enabled !== false).map(card => ({\n        promptId: card.promptId || card.prompt_id,\n        title: card.title || \"Untitled\",\n        prompt_text: card.prompt_text || card.content || \"\",\n        tags: card.tags || [],\n        isActive: card.isActive !== false,\n        stepOrder: card.stepOrder || 0\n      })).filter(card => card.prompt_text.trim()) // í”„ë¡¬í”„íŠ¸ ë‚´ìš©ì´ ìˆëŠ” ê²ƒë§Œ\n      .sort((a, b) => (a.stepOrder || 0) - (b.stepOrder || 0)); // stepOrderë¡œ ì •ë ¬\n\n      console.log(\"ëŒ€í™” ì „ì†¡ ë°ì´í„° í™•ì¸:\", {\n        messageContent: userMessage.content,\n        chatHistoryLength: trimmedChatHistory.length,\n        promptCardsCount: activePromptCards.length,\n        chatHistory: trimmedChatHistory,\n        promptCards: activePromptCards.map(card => ({\n          id: card.promptId,\n          title: card.title,\n          contentLength: card.prompt_text.length,\n          stepOrder: card.stepOrder,\n          hasContent: !!card.prompt_text.trim()\n        }))\n      });\n\n      // WebSocket ì—°ê²° í™•ì¸ ë° ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‹œë„\n      if (wsConnected) {\n        console.log(\"WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘\");\n        console.log(\"ìŠ¤íŠ¸ë¦¬ë° ë§¤ê°œë³€ìˆ˜ í™•ì¸:\", {\n          projectId,\n          userInput: userMessage.content,\n          conversationId,\n          userSub: user === null || user === void 0 ? void 0 : user.id,\n          historyLength: trimmedChatHistory.length,\n          promptCardsLength: activePromptCards.length\n        });\n        const success = wsStartStreaming(userMessage.content, trimmedChatHistory, activePromptCards, selectedModel, conversationId, // Add conversationId\n        user === null || user === void 0 ? void 0 : user.id // Add userSub from AuthContext\n        );\n        if (success) {\n          // WebSocket ìŠ¤íŠ¸ë¦¬ë° ì„±ê³µ, ë‚˜ë¨¸ì§€ëŠ” ë¦¬ìŠ¤ë„ˆì—ì„œ ì²˜ë¦¬\n          return;\n        } else {\n          console.log(\"WebSocket ì „ì†¡ ì‹¤íŒ¨, SSE í´ë°± ëª¨ë“œë¡œ ì „í™˜\");\n        }\n      } else {\n        console.log(\"WebSocket ë¯¸ì—°ê²°, SSE ëª¨ë“œ ì‚¬ìš©\");\n      }\n\n      // ğŸŒŸ ë©€í‹°-ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì‹¤í–‰\n      console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì‹¤í–‰ ì‹œì‘\");\n\n      // 1. ë¨¼ì € í”„ë¡¬í”„íŠ¸ ì¹´ë“œë“¤ì„ crew ì¸ìŠ¤í„´ìŠ¤ë¡œ ìƒì„±\n      if (activePromptCards.length > 0) {\n        try {\n          console.log(\"í”„ë¡¬í”„íŠ¸ ì¹´ë“œ â†’ í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ë³€í™˜ ì‹œë„\");\n          await crewAPI.createCrewInstance(projectId, activePromptCards);\n          console.log(\"í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ\");\n        } catch (instanceError) {\n          console.log(\"í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨ (ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ê¸°íƒ€ ì´ìœ ):\", instanceError.message);\n          // ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê³„ì† ì§„í–‰\n        }\n      }\n\n      // 2. ë©€í‹°-ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰\n      const multiAgentResult = await crewAPI.executeMultiAgent(projectId, userMessage.content, progress => {\n        // ì§„í–‰ìƒí™© ì—…ë°ì´íŠ¸ (ì˜µì…˜)\n        console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì§„í–‰ìƒí™©:\", progress);\n      });\n      console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‹¤í–‰ ì™„ë£Œ:\", multiAgentResult);\n\n      // 3. ê²°ê³¼ë¥¼ UI ë©”ì‹œì§€ë¡œ ë³€í™˜\n      const assistantMessage = processMultiAgentResponse(multiAgentResult);\n\n      // 4. ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ìµœì¢… ê²°ê³¼ë¡œ êµì²´\n      setMessages(prev => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(msg => msg.id === streamingMessageIdRef.current);\n        if (streamingMsgIndex !== -1) {\n          updatedMessages[streamingMsgIndex] = assistantMessage;\n        } else {\n          updatedMessages.push(assistantMessage);\n        }\n        return updatedMessages;\n      });\n      streamingMessageIdRef.current = null;\n      setCanSendMessage(true);\n\n      // ì„±ê³µ í† ìŠ¤íŠ¸\n      toast.success(`${Object.keys(multiAgentResult.agentResults || {}).length}ê°œ ì—ì´ì „íŠ¸ ë¶„ì„ ì™„ë£Œ!`);\n    } catch (error) {\n      var _error$response;\n      console.error(\"ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:\", error);\n\n      // ê°œì„ ëœ ì˜¤ë¥˜ ë©”ì‹œì§€\n      const errorType = error.code === \"ECONNABORTED\" ? \"timeout\" : \"general\";\n      const errorMessage = {\n        id: \"error-\" + Date.now(),\n        type: \"assistant\",\n        content: errorType === \"timeout\" ? \"ì²˜ë¦¬ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ìš”ì²­ì´ ë³µì¡í•˜ê±°ë‚˜ ì„œë²„ê°€ ë°”ìœ ìƒíƒœì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\" : \"ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n        timestamp: new Date().toISOString(),\n        isError: true,\n        errorDetails: {\n          type: errorType,\n          message: error.message,\n          status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status\n        }\n      };\n      setMessages(prev => {\n        // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì•„ ì œê±°\n        const currentStreamingId = streamingMessageIdRef.current;\n        const filteredMessages = prev.filter(msg => msg.id !== currentStreamingId);\n        return [...filteredMessages, errorMessage];\n      });\n      streamingMessageIdRef.current = null;\n\n      // ì˜¤ë¥˜ ë°œìƒ ì‹œë„ ì…ë ¥ í™œì„±í™”\n      setCanSendMessage(true);\n    }\n\n    // ì „ì²´ ì „ì†¡ ê³¼ì • ì™„ë£Œ í›„ ì…ë ¥ í™œì„±í™” (ë³´í—˜ìš©)\n    setCanSendMessage(true);\n  }, [inputValue, isGenerating, executeOrchestration, handleStreamingResponse, handleStreamingComplete, messages]);\n\n  /**\n   * Enter í‚¤ë¡œ ì „ì†¡\n   */\n  const handleKeyPress = useCallback(e => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  }, [handleSendMessage]);\n\n  /**\n   * ë©”ì‹œì§€ ë³µì‚¬\n   */\n  const handleCopyMessage = useCallback(async (content, messageId) => {\n    const success = await copyToClipboard(content);\n    if (success) {\n      setCopiedMessage(messageId);\n      setTimeout(() => setCopiedMessage(null), 2000);\n    }\n  }, []);\n\n  /**\n   * ê°œë³„ ì œëª© ë³µì‚¬\n   */\n  const handleCopyTitle = useCallback(async (title, messageId, index) => {\n    const success = await copyToClipboard(title, \"ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\");\n    if (success) {\n      setCopiedMessage(`${messageId}_title_${index}`);\n      setTimeout(() => setCopiedMessage(null), 2000);\n    }\n  }, []);\n\n  /**\n   * ì±„íŒ… ì´ˆê¸°í™”\n   */\n  const resetChat = useCallback(() => {\n    setMessages([]);\n    setInputValue(\"\");\n    setCopiedMessage(null);\n    setCanSendMessage(true);\n    streamingMessageIdRef.current = null;\n    currentWebSocketRef.current = null;\n    currentExecutionIdRef.current = null;\n    resetOrchestration();\n  }, [resetOrchestration]);\n  return {\n    messages,\n    inputValue,\n    setInputValue,\n    handleInputChange,\n    // ìƒˆë¡œìš´ ì…ë ¥ í•¸ë“¤ëŸ¬\n    copiedMessage,\n    isGenerating,\n    isStreaming,\n    canSendMessage,\n    streamingMessageId: streamingMessageIdRef.current,\n    messagesEndRef,\n    inputRef,\n    inputHeight,\n    // ë™ì  ë†’ì´\n    handleSendMessage,\n    handleStopGeneration,\n    handleKeyPress,\n    handleCopyMessage,\n    handleCopyTitle,\n    resetChat,\n    scrollToBottom,\n    // WebSocket ìƒíƒœ ì¶”ê°€\n    wsConnected,\n    wsConnecting,\n    wsError,\n    // ìŠ¤í¬ë¡¤ ê´€ë ¨ ì¶”ê°€\n    scrollContainerRef,\n    handleScroll,\n    isUserScrolling,\n    // ëª¨ë¸ ì„ íƒ ê´€ë ¨ ì¶”ê°€\n    selectedModel,\n    setSelectedModel\n  };\n};\n_s(useChat, \"dTWQ04RNb/Opvsn8gyLzvrT+1wk=\", false, function () {\n  return [useAuth, useOrchestration, useWebSocket];\n});","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","toast","copyToClipboard","useOrchestration","useWebSocket","crewAPI","useAuth","processMultiAgentResponse","result","console","error","id","Date","now","type","content","timestamp","toISOString","isError","agentResults","finalTitles","tokenUsage","agentSummary","Object","keys","map","agentType","agentResult","titles","agentName","getAgentName","tokenCount","allTitles","values","flat","formatMultiAgentContent","isMultiAgent","agentNames","journalism","balanced","click","seo","social","length","forEach","title","index","agent","useChat","projectId","projectName","promptCards","conversationId","_s","user","isFirstRender","current","log","promptCardsLength","userId","messages","setMessages","inputValue","setInputValue","copiedMessage","setCopiedMessage","canSendMessage","setCanSendMessage","inputHeight","setInputHeight","selectedModel","setSelectedModel","streamingMessageIdRef","currentWebSocketRef","currentExecutionIdRef","messagesEndRef","inputRef","isUserScrolling","setIsUserScrolling","scrollContainerRef","lastScrollTopRef","isExecuting","isGenerating","isStreaming","executeOrchestration","resetOrchestration","isConnected","wsConnected","isConnecting","wsConnecting","wsError","startStreaming","wsStartStreaming","addMessageListener","removeMessageListener","handleScroll","container","currentScrollTop","scrollTop","maxScrollTop","scrollHeight","clientHeight","Math","abs","isAtBottom","scrollToBottom","scrollIntoView","behavior","handleWebSocketMessage","event","data","JSON","parse","currentStreamingId","step","progress","prev","updatedMessages","streamingMsgIndex","findIndex","msg","messagesLength","currentContent","isLoading","m","fullContent","message","handleStreamingResponse","chunk","metadata","handleStreamingComplete","performance_metrics","model_info","handleStopGeneration","close","success","adjustInputHeight","value","trim","lines","split","charBasedLines","ceil","estimatedLines","max","calculatedHeight","min","handleInputChange","handleSendMessage","userMessage","streamMsgId","streamingMessage","allMessages","chatHistory","filter","role","maxHistoryLength","trimmedChatHistory","slice","totalMessages","fullHistoryLength","trimmedHistoryLength","recentHistory","safePromptCards","Array","isArray","activePromptCards","card","isActive","enabled","promptId","prompt_id","prompt_text","tags","stepOrder","sort","a","b","messageContent","chatHistoryLength","promptCardsCount","contentLength","hasContent","userInput","userSub","historyLength","createCrewInstance","instanceError","multiAgentResult","executeMultiAgent","assistantMessage","push","_error$response","errorType","code","errorMessage","errorDetails","status","response","filteredMessages","handleKeyPress","e","key","shiftKey","preventDefault","handleCopyMessage","messageId","setTimeout","handleCopyTitle","resetChat","streamingMessageId"],"sources":["/Users/yeong-gwang/Documents/work/á„‰á…¥á„‹á…®á†¯á„€á…§á†¼á„Œá…¦á„‰á…µá†«á„†á…®á†«/dev/nexus/title_generator_ver1/frontend/src/hooks/useChat.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { toast } from \"react-hot-toast\";\nimport { copyToClipboard } from \"../utils/clipboard\";\nimport { useOrchestration } from \"./useOrchestration\";\nimport { useWebSocket } from \"./useWebSocket\";\nimport { crewAPI } from \"../services/api\";\nimport { useAuth } from \"../contexts/AuthContext\";\n\n/**\n * ë©€í‹°-ì—ì´ì „íŠ¸ AI ì‘ë‹µì„ íŒŒì‹±í•˜ê³  UIì— ë§ëŠ” ë©”ì‹œì§€ ê°ì²´ë¡œ ë³€í™˜\n */\nconst processMultiAgentResponse = (result) => {\n  if (!result) {\n    console.error(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‘ë‹µ ì˜¤ë¥˜: ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤\", result);\n    return {\n      id: \"error-\" + Date.now(),\n      type: \"assistant\",\n      content: \"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n      timestamp: new Date().toISOString(),\n      isError: true,\n    };\n  }\n\n  // ë©€í‹°-ì—ì´ì „íŠ¸ ê²°ê³¼ êµ¬ì„±\n  const agentResults = result.agentResults || {};\n  const finalTitles = result.finalTitles || {};\n  const tokenUsage = result.tokenUsage || 0;\n\n  // ì—ì´ì „íŠ¸ë³„ ê²°ê³¼ë¥¼ í¬ë§·íŒ…\n  const agentSummary = Object.keys(agentResults).map(agentType => {\n    const agentResult = agentResults[agentType];\n    const titles = finalTitles[agentType] || [];\n    \n    return {\n      agentType,\n      agentName: getAgentName(agentType),\n      result: agentResult?.content || \"ê²°ê³¼ ì—†ìŒ\",\n      titles: titles,\n      tokenCount: agentResult?.tokenCount || 0\n    };\n  });\n\n  // ì „ì²´ ì œëª© ëª©ë¡ ìƒì„±\n  const allTitles = Object.values(finalTitles).flat();\n\n  return {\n    id: \"multi-agent-\" + Date.now(),\n    type: \"assistant\",\n    content: formatMultiAgentContent(agentSummary, allTitles),\n    timestamp: new Date(),\n    // ë©€í‹°-ì—ì´ì „íŠ¸ íŠ¹í™” ë°ì´í„°\n    isMultiAgent: true,\n    agentResults: agentSummary,\n    allTitles: allTitles,\n    tokenUsage: tokenUsage,\n  };\n};\n\n/**\n * ì—ì´ì „íŠ¸ íƒ€ì…ì„ í•œêµ­ì–´ ì´ë¦„ìœ¼ë¡œ ë³€í™˜\n */\nconst getAgentName = (agentType) => {\n  const agentNames = {\n    journalism: \"ğŸ“° ì €ë„ë¦¬ì¦˜ ì¶©ì‹¤í˜•\",\n    balanced: \"âš–ï¸ ê· í˜•ì¡íŒ í›„í‚¹í˜•\", \n    click: \"ğŸ¯ í´ë¦­ìœ ë„í˜•\",\n    seo: \"ğŸ” SEO/AEO ìµœì í™”í˜•\",\n    social: \"ğŸ“± ì†Œì…œë¯¸ë””ì–´ ê³µìœ í˜•\"\n  };\n  return agentNames[agentType] || `ğŸ¤– ${agentType}`;\n};\n\n/**\n * ë©€í‹°-ì—ì´ì „íŠ¸ ê²°ê³¼ë¥¼ UI í‘œì‹œìš© í…ìŠ¤íŠ¸ë¡œ í¬ë§·íŒ…\n */\nconst formatMultiAgentContent = (agentSummary, allTitles) => {\n  let content = \"ğŸš€ **ë©€í‹°-ì—ì´ì „íŠ¸ ë¶„ì„ ì™„ë£Œ**\\n\\n\";\n  \n  // ì „ì²´ ì œëª© ìš”ì•½\n  if (allTitles.length > 0) {\n    content += \"ğŸ“‹ **ìƒì„±ëœ ì œëª© ëª©ë¡:**\\n\";\n    allTitles.forEach((title, index) => {\n      content += `${index + 1}. ${title}\\n`;\n    });\n    content += \"\\n\";\n  }\n\n  // ì—ì´ì „íŠ¸ë³„ ìƒì„¸ ê²°ê³¼\n  content += \"ğŸ” **ì—ì´ì „íŠ¸ë³„ ë¶„ì„ ê²°ê³¼:**\\n\\n\";\n  agentSummary.forEach(agent => {\n    content += `### ${agent.agentName}\\n`;\n    if (agent.titles.length > 0) {\n      content += \"**ìƒì„± ì œëª©:**\\n\";\n      agent.titles.forEach(title => {\n        content += `â€¢ ${title}\\n`;\n      });\n    }\n    content += `**í† í° ì‚¬ìš©ëŸ‰:** ${agent.tokenCount}ê°œ\\n\\n`;\n  });\n\n  return content;\n};\n\n/**\n * ì±„íŒ… ê¸°ëŠ¥ì„ ìœ„í•œ ì»¤ìŠ¤í…€ í›…\n * @param {string} projectId - í”„ë¡œì íŠ¸ ID\n * @param {string} projectName - í”„ë¡œì íŠ¸ ì´ë¦„\n * @param {Array} promptCards - í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ë°°ì—´\n * @returns {Object} - ì±„íŒ… ê´€ë ¨ ìƒíƒœì™€ í•¨ìˆ˜ë“¤\n */\nexport const useChat = (projectId, projectName, promptCards = [], conversationId = null) => {\n  const { user } = useAuth(); // Add user from AuthContext\n  \n  // ë””ë²„ê¹… ë¡œê·¸ (ì²« ë²ˆì§¸ ë Œë”ë§ì—ë§Œ)\n  const isFirstRender = useRef(true);\n  if (isFirstRender.current) {\n    console.log('useChat ì´ˆê¸°í™”:', {\n      projectId,\n      projectName,\n      promptCardsLength: promptCards?.length,\n      conversationId,\n      userId: user?.id\n    });\n    isFirstRender.current = false;\n  }\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [copiedMessage, setCopiedMessage] = useState(null);\n  const [canSendMessage, setCanSendMessage] = useState(true);\n  const [inputHeight, setInputHeight] = useState(24); // ë™ì  ë†’ì´ ê´€ë¦¬\n  const [selectedModel, setSelectedModel] = useState(\"anthropic.claude-3-5-sonnet-20241022-v2:0\");\n  const streamingMessageIdRef = useRef(null);\n  const currentWebSocketRef = useRef(null);\n  const currentExecutionIdRef = useRef(null);\n  \n\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n\n  // ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ìƒíƒœ ì¶”ì \n  const [isUserScrolling, setIsUserScrolling] = useState(false);\n  const scrollContainerRef = useRef(null);\n  const lastScrollTopRef = useRef(0);\n\n  const {\n    isExecuting: isGenerating,\n    isStreaming,\n    executeOrchestration,\n    resetOrchestration,\n  } = useOrchestration(projectId);\n\n  // WebSocket í›… ì¶”ê°€\n  const {\n    isConnected: wsConnected,\n    isConnecting: wsConnecting,\n    error: wsError,\n    startStreaming: wsStartStreaming,\n    addMessageListener,\n    removeMessageListener,\n  } = useWebSocket(projectId);\n\n  // ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì • - projectId ë³€ê²½ì‹œì—ë§Œ ì´ˆê¸°í™”\n  useEffect(() => {\n    setMessages([]); // ë¹ˆ ë°°ì—´ë¡œ ì‹œì‘\n  }, [projectId]); // projectName ëŒ€ì‹  projectId ì‚¬ìš©\n\n  // ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ê°ì§€ í•¨ìˆ˜\n  const handleScroll = useCallback(() => {\n    if (!scrollContainerRef.current) return;\n\n    const container = scrollContainerRef.current;\n    const currentScrollTop = container.scrollTop;\n    const maxScrollTop = container.scrollHeight - container.clientHeight;\n\n    // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤í–ˆëŠ”ì§€ ê°ì§€\n    if (Math.abs(currentScrollTop - lastScrollTopRef.current) > 2) {\n      const isAtBottom = currentScrollTop >= maxScrollTop - 20;\n\n      // í•˜ë‹¨ì— ìˆì„ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤ í—ˆìš©, ê·¸ ì™¸ëŠ” ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ëª¨ë“œ\n      setIsUserScrolling(!isAtBottom);\n    }\n\n    lastScrollTopRef.current = currentScrollTop;\n  }, []);\n\n  const scrollToBottom = useCallback(() => {\n    // ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤\n    if (!isUserScrolling && messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [isUserScrolling]);\n\n  // ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ (ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  // WebSocket ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •\n  useEffect(() => {\n    const handleWebSocketMessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        console.log(\"WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :\", data);\n\n        const currentStreamingId = streamingMessageIdRef.current;\n\n        switch (data.type) {\n          case \"stream_start\":\n            console.log(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘\");\n            break;\n\n          case \"progress\":\n            // ì§„í–‰ ìƒí™© ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  UI ì—…ë°ì´íŠ¸ëŠ” ì œê±°\n            console.log(`ì§„í–‰ ìƒí™©: ${data.step} (${data.progress}%)`);\n            break;\n\n          case \"stream_chunk\":\n            if (currentStreamingId) {\n              setMessages((prev) => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(\n                  (msg) => msg.id === currentStreamingId\n                );\n\n                console.log(\"ìŠ¤íŠ¸ë¦¼ ì²­í¬ ì²˜ë¦¬:\", {\n                  currentStreamingId,\n                  streamingMsgIndex,\n                  messagesLength: prev.length,\n                  content: data.content\n                });\n\n                if (streamingMsgIndex !== -1) {\n                  // ê¸°ì¡´ ë‚´ìš©ì— ìƒˆ ì²­í¬ ì¶”ê°€\n                  const currentContent =\n                    updatedMessages[streamingMsgIndex].content || \"\";\n\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content: currentContent + data.content,\n                    isLoading: true,\n                    isStreaming: true,\n                  };\n                  \n                  console.log(\"ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ë¨:\", updatedMessages[streamingMsgIndex]);\n                } else {\n                  console.log(\"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ë©”ì‹œì§€ IDë“¤:\", prev.map(m => m.id));\n                }\n\n                return updatedMessages;\n              });\n              // ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì—ëŠ” ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìë™ ìŠ¤í¬ë¡¤\n              if (!isUserScrolling) {\n                scrollToBottom();\n              }\n            } else {\n              console.log(\"currentStreamingIdê°€ nullì„\");\n            }\n            break;\n\n          case \"stream_complete\":\n            if (currentStreamingId) {\n              setMessages((prev) => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(\n                  (msg) => msg.id === currentStreamingId\n                );\n\n                if (streamingMsgIndex !== -1) {\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content: data.fullContent,\n                    isLoading: false,\n                    isStreaming: false,\n                    timestamp: new Date().toISOString(),\n                  };\n                }\n\n                return updatedMessages;\n              });\n              streamingMessageIdRef.current = null;\n              scrollToBottom();\n            }\n            break;\n\n          case \"error\":\n            console.error(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì˜¤ë¥˜:\", data.message);\n            if (currentStreamingId) {\n              setMessages((prev) => {\n                const updatedMessages = [...prev];\n                const streamingMsgIndex = updatedMessages.findIndex(\n                  (msg) => msg.id === currentStreamingId\n                );\n\n                if (streamingMsgIndex !== -1) {\n                  updatedMessages[streamingMsgIndex] = {\n                    ...updatedMessages[streamingMsgIndex],\n                    content:\n                      \"ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n                    isLoading: false,\n                    isStreaming: false,\n                    isError: true,\n                    timestamp: new Date().toISOString(),\n                  };\n                }\n\n                return updatedMessages;\n              });\n              streamingMessageIdRef.current = null;\n            }\n            toast.error(data.message);\n            break;\n\n          default:\n            console.log(\"ì•Œ ìˆ˜ ì—†ëŠ” WebSocket ë©”ì‹œì§€ íƒ€ì…:\", data.type);\n        }\n      } catch (error) {\n        console.error(\"WebSocket ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:\", error);\n      }\n    };\n\n    if (wsConnected) {\n      addMessageListener(handleWebSocketMessage);\n    }\n\n    return () => {\n      if (wsConnected) {\n        removeMessageListener(handleWebSocketMessage);\n      }\n    };\n  }, [wsConnected, addMessageListener, removeMessageListener, scrollToBottom]);\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬ í•¨ìˆ˜\n   */\n  const handleStreamingResponse = useCallback(\n    (chunk, metadata) => {\n      const currentStreamingId = streamingMessageIdRef.current;\n\n      console.log(\"ì²­í¬ ìˆ˜ì‹ :\", chunk, \"ìŠ¤íŠ¸ë¦¬ë° ID:\", currentStreamingId);\n\n      if (!currentStreamingId) {\n        console.error(\"ìŠ¤íŠ¸ë¦¬ë° IDê°€ ì—†ìŠµë‹ˆë‹¤!\");\n        return;\n      }\n\n      setMessages((prev) => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(\n          (msg) => msg.id === currentStreamingId\n        );\n\n        if (streamingMsgIndex !== -1) {\n          // ê¸°ì¡´ ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸\n          updatedMessages[streamingMsgIndex] = {\n            ...updatedMessages[streamingMsgIndex],\n            content: updatedMessages[streamingMsgIndex].content + chunk,\n            isLoading: true,\n            isStreaming: true,\n          };\n          console.log(\n            \"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ ì„±ê³µ:\",\n            updatedMessages[streamingMsgIndex].content\n          );\n        } else {\n          console.error(\"ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:\", currentStreamingId);\n        }\n\n        return updatedMessages;\n      });\n\n      // ìŠ¤í¬ë¡¤ ì¡°ì • (ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)\n      if (!isUserScrolling) {\n        scrollToBottom();\n      }\n    },\n    [scrollToBottom, isUserScrolling]\n  );\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n   */\n  const handleStreamingComplete = useCallback(\n    (result) => {\n      const currentStreamingId = streamingMessageIdRef.current;\n\n      console.log(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ:\", result, \"ìŠ¤íŠ¸ë¦¬ë° ID:\", currentStreamingId);\n\n      if (!currentStreamingId) {\n        console.error(\"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì¤‘ IDê°€ ì—†ìŠµë‹ˆë‹¤!\");\n        return;\n      }\n\n      setMessages((prev) => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(\n          (msg) => msg.id === currentStreamingId\n        );\n\n        if (streamingMsgIndex !== -1) {\n          // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì™„ë£Œ ì²˜ë¦¬\n          updatedMessages[streamingMsgIndex] = {\n            ...updatedMessages[streamingMsgIndex],\n            content: result.result,\n            isLoading: false,\n            isStreaming: false,\n            performance_metrics: result.performance_metrics,\n            model_info: result.model_info,\n            timestamp: new Date().toISOString(),\n          };\n          console.log(\n            \"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì„±ê³µ:\",\n            updatedMessages[streamingMsgIndex].content\n          );\n        } else {\n          console.error(\n            \"ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:\",\n            currentStreamingId\n          );\n        }\n\n        return updatedMessages;\n      });\n\n      // ìŠ¤íŠ¸ë¦¬ë° ID ì´ˆê¸°í™”\n      streamingMessageIdRef.current = null;\n\n      // ì…ë ¥ í™œì„±í™”\n      console.log(\"WebSocket ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ - ì…ë ¥ í™œì„±í™”\");\n      setCanSendMessage(true);\n\n      // ìŠ¤í¬ë¡¤ ì¡°ì • (ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œì—ëŠ” í•­ìƒ í•˜ë‹¨ìœ¼ë¡œ)\n      scrollToBottom();\n    },\n    [scrollToBottom]\n  );\n\n  /**\n   * ìŠ¤íŠ¸ë¦¬ë° ì¤‘ë‹¨ í•¨ìˆ˜\n   */\n  const handleStopGeneration = useCallback(() => {\n    console.log(\"ìƒì„± ì¤‘ë‹¨ ìš”ì²­\");\n\n    // WebSocket ì—°ê²° ì¢…ë£Œ\n    if (currentWebSocketRef.current) {\n      currentWebSocketRef.current.close();\n      currentWebSocketRef.current = null;\n    }\n\n    // í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… ì¤‘ë‹¨\n    if (currentExecutionIdRef.current) {\n      // ì—¬ê¸°ì„œ ì‹¤ì œ API í˜¸ì¶œ ì¤‘ë‹¨ ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\n      currentExecutionIdRef.current = null;\n    }\n\n    // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ìƒíƒœ ì—…ë°ì´íŠ¸\n    const currentStreamingId = streamingMessageIdRef.current;\n    if (currentStreamingId) {\n      setMessages((prev) => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(\n          (msg) => msg.id === currentStreamingId\n        );\n\n        if (streamingMsgIndex !== -1) {\n          updatedMessages[streamingMsgIndex] = {\n            ...updatedMessages[streamingMsgIndex],\n            content:\n              updatedMessages[streamingMsgIndex].content +\n              \"\\n\\n[ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤]\",\n            isLoading: false,\n            isStreaming: false,\n            timestamp: new Date().toISOString(),\n          };\n        }\n\n        return updatedMessages;\n      });\n\n      streamingMessageIdRef.current = null;\n    }\n\n    // ì…ë ¥ ê°€ëŠ¥ ìƒíƒœë¡œ ë³µì›\n    setCanSendMessage(true);\n\n    // orchestration ìƒíƒœ ë¦¬ì…‹\n    resetOrchestration();\n\n    toast.success(\"ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤\");\n  }, [resetOrchestration]);\n\n  /**\n   * ì…ë ¥ì°½ ë†’ì´ ìë™ ì¡°ì ˆ\n   */\n  const adjustInputHeight = useCallback((value) => {\n    if (!value.trim()) {\n      setInputHeight(24); // ê¸°ë³¸ ë†’ì´\n      return;\n    }\n    \n    // ì¤„ ìˆ˜ ê³„ì‚° (ëŒ€ëµì )\n    const lines = value.split('\\n').length;\n    const charBasedLines = Math.ceil(value.length / 80); // 80ìë‹¹ 1ì¤„ë¡œ ì¶”ì •\n    const estimatedLines = Math.max(lines, charBasedLines);\n    \n    // ë†’ì´ ê³„ì‚° (lineHeight: 1.4, fontSize: 16px)\n    let calculatedHeight;\n    if (estimatedLines <= 3) {\n      calculatedHeight = 24 + (estimatedLines - 1) * 22; // ê¸°ë³¸ + ì¶”ê°€ ì¤„\n    } else if (estimatedLines <= 10) {\n      calculatedHeight = 150 + (estimatedLines - 6) * 15; // ì¤‘ê°„ ë²”ìœ„\n    } else {\n      calculatedHeight = Math.min(400, 150 + (estimatedLines - 6) * 12); // ìµœëŒ€ 400px\n    }\n    \n    setInputHeight(Math.max(24, calculatedHeight));\n  }, []);\n  \n  /**\n   * ì…ë ¥ê°’ ë³€ê²½ ì²˜ë¦¬\n   */\n  const handleInputChange = useCallback((value) => {\n    setInputValue(value);\n    adjustInputHeight(value);\n  }, [adjustInputHeight]);\n\n  /**\n   * ë©”ì‹œì§€ ì „ì†¡\n   */\n  const handleSendMessage = useCallback(async () => {\n    console.log(\"í•´ë“¤ ì „ì†¡ í˜¸ì¶œ:\", {\n      inputValue: inputValue.trim(),\n      isGenerating,\n      canSendMessage,\n    });\n\n    if (!inputValue.trim() || isGenerating) {\n      console.log(\"ì „ì†¡ ì¤‘ë‹¨: ì¡°ê±´ ë¶€ì¡±\");\n      return;\n    }\n\n    // ì…ë ¥ ë¹„í™œì„±í™”\n    console.log(\"ì…ë ¥ ë¹„í™œì„±í™”\");\n    setCanSendMessage(false);\n\n    const userMessage = {\n      id: \"user-\" + Date.now(),\n      type: \"user\",\n      content: inputValue.trim(),\n      timestamp: new Date().toISOString(),\n    };\n\n    // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ID ìƒì„±\n    const streamMsgId = \"streaming-\" + Date.now();\n    streamingMessageIdRef.current = streamMsgId;\n\n    console.log(\"ìƒˆ ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ID ìƒì„±:\", streamMsgId);\n\n    // ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ìœ„í•œ ì´ˆê¸° ë©”ì‹œì§€\n    const streamingMessage = {\n      id: streamMsgId,\n      type: \"assistant\",\n      content: \"\",\n      timestamp: new Date().toISOString(),\n      isLoading: true,\n      isStreaming: true,\n    };\n\n    setMessages((prev) => [...prev, userMessage, streamingMessage]);\n    setInputValue(\"\");\n    setInputHeight(24); // ì…ë ¥ì°½ ë†’ì´ ì´ˆê¸°í™”\n\n    // ê¸°ì¡´ ë©”ì‹œì§€ + í˜„ì¬ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í¬í•¨í•œ ëŒ€í™” íˆìŠ¤í† ë¦¬ ìƒì„±\n    const allMessages = [...messages, userMessage];\n    const chatHistory = allMessages\n      .filter((msg) => !msg.isLoading && !msg.isError && !msg.isStreaming)\n      .map((msg) => ({\n        role: msg.type === \"user\" ? \"user\" : \"assistant\",\n        content: msg.content,\n      }));\n\n    // ìµœëŒ€ ëŒ€í™” ê¸°ì–µ ì„¤ì • (ìµœê·¼ 50ê°œ ë©”ì‹œì§€ë¡œ ìµœëŒ€ ë©”ëª¨ë¦¬ ìœ ì§€)\n    const maxHistoryLength = 50;\n    const trimmedChatHistory = chatHistory.slice(-maxHistoryLength);\n\n    console.log(\"ëŒ€í™” íˆìŠ¤í† ë¦¬ ìƒì„±:\", {\n      totalMessages: allMessages.length,\n      fullHistoryLength: chatHistory.length,\n      trimmedHistoryLength: trimmedChatHistory.length,\n      maxHistoryLength: maxHistoryLength,\n      recentHistory: trimmedChatHistory.slice(-6), // ìµœê·¼ 6ê°œë§Œ ë¡œê·¸ì— í‘œì‹œ\n    });\n\n    try {\n      // í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ì •ë³´ ì¶”ê°€ - í™œì„±í™”ëœ ì¹´ë“œë§Œ í•„í„°ë§í•˜ê³  ë°±ì—”ë“œ í˜•ì‹ì— ë§ê²Œ ë³€í™˜\n      const safePromptCards = Array.isArray(promptCards) ? promptCards : [];\n      const activePromptCards = safePromptCards\n        .filter((card) => card.isActive !== false && card.enabled !== false)\n        .map((card) => ({\n          promptId: card.promptId || card.prompt_id,\n          title: card.title || \"Untitled\",\n          prompt_text: card.prompt_text || card.content || \"\",\n          tags: card.tags || [],\n          isActive: card.isActive !== false,\n          stepOrder: card.stepOrder || 0,\n        }))\n        .filter((card) => card.prompt_text.trim()) // í”„ë¡¬í”„íŠ¸ ë‚´ìš©ì´ ìˆëŠ” ê²ƒë§Œ\n        .sort((a, b) => (a.stepOrder || 0) - (b.stepOrder || 0)); // stepOrderë¡œ ì •ë ¬\n\n      console.log(\"ëŒ€í™” ì „ì†¡ ë°ì´í„° í™•ì¸:\", {\n        messageContent: userMessage.content,\n        chatHistoryLength: trimmedChatHistory.length,\n        promptCardsCount: activePromptCards.length,\n        chatHistory: trimmedChatHistory,\n        promptCards: activePromptCards.map((card) => ({\n          id: card.promptId,\n          title: card.title,\n          contentLength: card.prompt_text.length,\n          stepOrder: card.stepOrder,\n          hasContent: !!card.prompt_text.trim(),\n        })),\n      });\n\n      // WebSocket ì—°ê²° í™•ì¸ ë° ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‹œë„\n      if (wsConnected) {\n        console.log(\"WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘\");\n        console.log(\"ìŠ¤íŠ¸ë¦¬ë° ë§¤ê°œë³€ìˆ˜ í™•ì¸:\", {\n          projectId,\n          userInput: userMessage.content,\n          conversationId,\n          userSub: user?.id,\n          historyLength: trimmedChatHistory.length,\n          promptCardsLength: activePromptCards.length\n        });\n\n        const success = wsStartStreaming(\n          userMessage.content,\n          trimmedChatHistory,\n          activePromptCards,\n          selectedModel,\n          conversationId, // Add conversationId\n          user?.id // Add userSub from AuthContext\n        );\n\n        if (success) {\n          // WebSocket ìŠ¤íŠ¸ë¦¬ë° ì„±ê³µ, ë‚˜ë¨¸ì§€ëŠ” ë¦¬ìŠ¤ë„ˆì—ì„œ ì²˜ë¦¬\n          return;\n        } else {\n          console.log(\"WebSocket ì „ì†¡ ì‹¤íŒ¨, SSE í´ë°± ëª¨ë“œë¡œ ì „í™˜\");\n        }\n      } else {\n        console.log(\"WebSocket ë¯¸ì—°ê²°, SSE ëª¨ë“œ ì‚¬ìš©\");\n      }\n\n      // ğŸŒŸ ë©€í‹°-ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì‹¤í–‰\n      console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ ì‹¤í–‰ ì‹œì‘\");\n\n      // 1. ë¨¼ì € í”„ë¡¬í”„íŠ¸ ì¹´ë“œë“¤ì„ crew ì¸ìŠ¤í„´ìŠ¤ë¡œ ìƒì„±\n      if (activePromptCards.length > 0) {\n        try {\n          console.log(\"í”„ë¡¬í”„íŠ¸ ì¹´ë“œ â†’ í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ë³€í™˜ ì‹œë„\");\n          await crewAPI.createCrewInstance(projectId, activePromptCards);\n          console.log(\"í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ\");\n        } catch (instanceError) {\n          console.log(\"í¬ë£¨ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨ (ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ê¸°íƒ€ ì´ìœ ):\", instanceError.message);\n          // ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê³„ì† ì§„í–‰\n        }\n      }\n\n      // 2. ë©€í‹°-ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰\n      const multiAgentResult = await crewAPI.executeMultiAgent(\n        projectId, \n        userMessage.content,\n        (progress) => {\n          // ì§„í–‰ìƒí™© ì—…ë°ì´íŠ¸ (ì˜µì…˜)\n          console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì§„í–‰ìƒí™©:\", progress);\n        }\n      );\n\n      console.log(\"ë©€í‹°-ì—ì´ì „íŠ¸ ì‹¤í–‰ ì™„ë£Œ:\", multiAgentResult);\n\n      // 3. ê²°ê³¼ë¥¼ UI ë©”ì‹œì§€ë¡œ ë³€í™˜\n      const assistantMessage = processMultiAgentResponse(multiAgentResult);\n      \n      // 4. ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ìµœì¢… ê²°ê³¼ë¡œ êµì²´\n      setMessages((prev) => {\n        const updatedMessages = [...prev];\n        const streamingMsgIndex = updatedMessages.findIndex(\n          (msg) => msg.id === streamingMessageIdRef.current\n        );\n\n        if (streamingMsgIndex !== -1) {\n          updatedMessages[streamingMsgIndex] = assistantMessage;\n        } else {\n          updatedMessages.push(assistantMessage);\n        }\n\n        return updatedMessages;\n      });\n\n      streamingMessageIdRef.current = null;\n      setCanSendMessage(true);\n      \n      // ì„±ê³µ í† ìŠ¤íŠ¸\n      toast.success(`${Object.keys(multiAgentResult.agentResults || {}).length}ê°œ ì—ì´ì „íŠ¸ ë¶„ì„ ì™„ë£Œ!`);\n    } catch (error) {\n      console.error(\"ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:\", error);\n\n      // ê°œì„ ëœ ì˜¤ë¥˜ ë©”ì‹œì§€\n      const errorType = error.code === \"ECONNABORTED\" ? \"timeout\" : \"general\";\n      const errorMessage = {\n        id: \"error-\" + Date.now(),\n        type: \"assistant\",\n        content:\n          errorType === \"timeout\"\n            ? \"ì²˜ë¦¬ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ìš”ì²­ì´ ë³µì¡í•˜ê±°ë‚˜ ì„œë²„ê°€ ë°”ìœ ìƒíƒœì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\"\n            : \"ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\",\n        timestamp: new Date().toISOString(),\n        isError: true,\n        errorDetails: {\n          type: errorType,\n          message: error.message,\n          status: error.response?.status,\n        },\n      };\n\n      setMessages((prev) => {\n        // ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ë¥¼ ì°¾ì•„ ì œê±°\n        const currentStreamingId = streamingMessageIdRef.current;\n        const filteredMessages = prev.filter(\n          (msg) => msg.id !== currentStreamingId\n        );\n        return [...filteredMessages, errorMessage];\n      });\n\n      streamingMessageIdRef.current = null;\n\n      // ì˜¤ë¥˜ ë°œìƒ ì‹œë„ ì…ë ¥ í™œì„±í™”\n      setCanSendMessage(true);\n    }\n\n    // ì „ì²´ ì „ì†¡ ê³¼ì • ì™„ë£Œ í›„ ì…ë ¥ í™œì„±í™” (ë³´í—˜ìš©)\n    setCanSendMessage(true);\n  }, [\n    inputValue,\n    isGenerating,\n    executeOrchestration,\n    handleStreamingResponse,\n    handleStreamingComplete,\n    messages,\n  ]);\n\n  /**\n   * Enter í‚¤ë¡œ ì „ì†¡\n   */\n  const handleKeyPress = useCallback(\n    (e) => {\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        handleSendMessage();\n      }\n    },\n    [handleSendMessage]\n  );\n\n  /**\n   * ë©”ì‹œì§€ ë³µì‚¬\n   */\n  const handleCopyMessage = useCallback(async (content, messageId) => {\n    const success = await copyToClipboard(content);\n    if (success) {\n      setCopiedMessage(messageId);\n      setTimeout(() => setCopiedMessage(null), 2000);\n    }\n  }, []);\n\n  /**\n   * ê°œë³„ ì œëª© ë³µì‚¬\n   */\n  const handleCopyTitle = useCallback(async (title, messageId, index) => {\n    const success = await copyToClipboard(title, \"ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\");\n    if (success) {\n      setCopiedMessage(`${messageId}_title_${index}`);\n      setTimeout(() => setCopiedMessage(null), 2000);\n    }\n  }, []);\n\n  /**\n   * ì±„íŒ… ì´ˆê¸°í™”\n   */\n  const resetChat = useCallback(() => {\n    setMessages([]);\n    setInputValue(\"\");\n    setCopiedMessage(null);\n    setCanSendMessage(true);\n    streamingMessageIdRef.current = null;\n    currentWebSocketRef.current = null;\n    currentExecutionIdRef.current = null;\n    resetOrchestration();\n  }, [resetOrchestration]);\n\n  return {\n    messages,\n    inputValue,\n    setInputValue,\n    handleInputChange, // ìƒˆë¡œìš´ ì…ë ¥ í•¸ë“¤ëŸ¬\n    copiedMessage,\n    isGenerating,\n    isStreaming,\n    canSendMessage,\n    streamingMessageId: streamingMessageIdRef.current,\n    messagesEndRef,\n    inputRef,\n    inputHeight, // ë™ì  ë†’ì´\n    handleSendMessage,\n    handleStopGeneration,\n    handleKeyPress,\n    handleCopyMessage,\n    handleCopyTitle,\n    resetChat,\n    scrollToBottom,\n    // WebSocket ìƒíƒœ ì¶”ê°€\n    wsConnected,\n    wsConnecting,\n    wsError,\n    // ìŠ¤í¬ë¡¤ ê´€ë ¨ ì¶”ê°€\n    scrollContainerRef,\n    handleScroll,\n    isUserScrolling,\n    // ëª¨ë¸ ì„ íƒ ê´€ë ¨ ì¶”ê°€\n    selectedModel,\n    setSelectedModel,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}