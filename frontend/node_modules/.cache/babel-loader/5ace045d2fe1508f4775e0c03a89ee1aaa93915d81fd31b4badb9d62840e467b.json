{"ast":null,"code":"import{useState,useEffect,useRef,useCallback}from\"react\";/**\n * WebSocket Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞çÏùÑ ÏúÑÌïú Ïª§Ïä§ÌÖÄ ÌõÖ\n */export const useWebSocket=projectId=>{const[isConnected,setIsConnected]=useState(false);const[isConnecting,setIsConnecting]=useState(false);const[error,setError]=useState(null);const wsRef=useRef(null);const reconnectTimeoutRef=useRef(null);const reconnectAttempts=useRef(0);const maxReconnectAttempts=5;// WebSocket URL (ÌôòÍ≤ΩÎ≥ÄÏàòÎÇò Ïã§Ï†ú Î∞∞Ìè¨Îêú URLÎ°ú ÏÑ§Ï†ï)\nconst getWebSocketUrl=useCallback(()=>{const wsUrl=process.env.REACT_APP_WS_URL||\"wss://na17isxiri.execute-api.us-east-1.amazonaws.com/prod\";// URL ÌòïÏãù Í≤ÄÏ¶ù Î∞è Ï†ïÍ∑úÌôî\nif(!wsUrl.startsWith(\"wss://\")&&!wsUrl.startsWith(\"ws://\")){console.error(\"ÏûòÎ™ªÎêú WebSocket URL ÌòïÏãù:\",wsUrl);return null;}// ÎÅùÏóê Ïä¨ÎûòÏãú Ï†úÍ±∞\nconst normalizedUrl=wsUrl.replace(/\\/$/,\"\");console.log(\"WebSocket URL ÌôïÏù∏:\",normalizedUrl);console.log(\"ÌôòÍ≤ΩÎ≥ÄÏàò REACT_APP_WS_URL:\",process.env.REACT_APP_WS_URL);return normalizedUrl;},[]);// WebSocket Ïó∞Í≤∞\nconst connect=useCallback(()=>{var _wsRef$current,_wsRef$current2;// Ïù¥ÎØ∏ Ïó∞Í≤∞ Ï§ëÏù¥Í±∞ÎÇò Ïó∞Í≤∞Îêú Í≤ΩÏö∞ Ï§ëÎ≥µ Ïó∞Í≤∞ Î∞©ÏßÄ\nif(((_wsRef$current=wsRef.current)===null||_wsRef$current===void 0?void 0:_wsRef$current.readyState)===WebSocket.OPEN||((_wsRef$current2=wsRef.current)===null||_wsRef$current2===void 0?void 0:_wsRef$current2.readyState)===WebSocket.CONNECTING){console.log(\"Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú WebSocketÏù¥ ÏûàÏäµÎãàÎã§ (readyState:\",wsRef.current.readyState,\")\");return;}// Ïù¥Ï†Ñ Ïó∞Í≤∞Ïù¥ ÏûàÎã§Î©¥ Ï†ïÎ¶¨\nif(wsRef.current){wsRef.current.close();wsRef.current=null;}setIsConnecting(true);setError(null);try{const wsUrl=getWebSocketUrl();if(!wsUrl){setError(\"Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ WebSocket URL\");setIsConnecting(false);return;}console.log(\"WebSocket Ïó∞Í≤∞ ÏãúÎèÑ:\",wsUrl);console.log(\"Î∏åÎùºÏö∞Ï†Ä WebSocket ÏßÄÏõê:\",!!window.WebSocket);// Ïó∞Í≤∞ ÏãúÎèÑ ÏãúÍ∞Ñ Í∏∞Î°ù\nwindow.wsConnectStart=Date.now();wsRef.current=new WebSocket(wsUrl);// Ïó∞Í≤∞ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ\nconst connectionTimeout=setTimeout(()=>{var _wsRef$current3;if(((_wsRef$current3=wsRef.current)===null||_wsRef$current3===void 0?void 0:_wsRef$current3.readyState)===WebSocket.CONNECTING){console.error(\"WebSocket Ïó∞Í≤∞ ÏãúÍ∞Ñ Ï¥àÍ≥º\");wsRef.current.close();setError(\"Ïó∞Í≤∞ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§\");setIsConnecting(false);}},10000);// 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ\nwsRef.current.onopen=event=>{var _wsRef$current4,_wsRef$current5,_wsRef$current6;clearTimeout(connectionTimeout);console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ!\");console.log(\"- Event:\",event);console.log(\"- URL:\",(_wsRef$current4=wsRef.current)===null||_wsRef$current4===void 0?void 0:_wsRef$current4.url);console.log(\"- Protocol:\",(_wsRef$current5=wsRef.current)===null||_wsRef$current5===void 0?void 0:_wsRef$current5.protocol);console.log(\"- Extensions:\",(_wsRef$current6=wsRef.current)===null||_wsRef$current6===void 0?void 0:_wsRef$current6.extensions);setIsConnected(true);setIsConnecting(false);setError(null);reconnectAttempts.current=0;};wsRef.current.onclose=event=>{clearTimeout(connectionTimeout);const connectionDuration=Date.now()-(window.wsConnectStart||0);console.log(\"üî¥ WebSocket Ïó∞Í≤∞ Ï¢ÖÎ£å:\");console.log(\"- Code:\",event.code);console.log(\"- Reason:\",event.reason||\"(no reason provided)\");console.log(\"- WasClean:\",event.wasClean);console.log(\"- Connection duration:\",connectionDuration+\"ms\");setIsConnected(false);setIsConnecting(false);// Ï¶âÏãú Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ (500ms Ïù¥ÎÇ¥) - ÏÑúÎ≤Ñ Î¨∏Ï†ú\nif(connectionDuration<500){console.error(\"‚ö†Ô∏è WebSocketÏù¥ Ï¶âÏãú Ï¢ÖÎ£åÎê® - ÏÑúÎ≤Ñ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±\");// ÌäπÏ†ï ÏóêÎü¨ ÏΩîÎìúÏóê Îî∞Î•∏ ÏÑ∏Î∂ÑÌôîÎêú ÏóêÎü¨ Î©îÏãúÏßÄ\nlet errorMessage=\"ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\";switch(event.code){case 1006:errorMessage=\"ÎπÑÏ†ïÏÉÅÏ†ÅÏù∏ Ïó∞Í≤∞ Ï¢ÖÎ£å (ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±)\";break;case 1002:errorMessage=\"ÌîÑÎ°úÌÜ†ÏΩú Ïò§Î•ò\";break;case 1003:errorMessage=\"ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ\";break;case 1011:errorMessage=\"ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•ò\";break;}setError(errorMessage);return;}// ÏûêÎèô Ïû¨Ïó∞Í≤∞ (Ï†ïÏÉÅ Ï¢ÖÎ£åÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞)\nif(event.code!==1000&&reconnectAttempts.current<maxReconnectAttempts){const delay=Math.min(1000*Math.pow(2,reconnectAttempts.current),30000);console.log(`üîÑ ${delay}ms ÌõÑ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ (${reconnectAttempts.current+1}/${maxReconnectAttempts})`);reconnectTimeoutRef.current=setTimeout(()=>{reconnectAttempts.current++;connect();},delay);}else if(reconnectAttempts.current>=maxReconnectAttempts){setError(\"ÏµúÎåÄ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ÌöüÏàòÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§.\");}};wsRef.current.onerror=error=>{var _wsRef$current7,_wsRef$current8;clearTimeout(connectionTimeout);console.error(\"üí• WebSocket Ïò§Î•ò:\",error);console.log(\"- ReadyState:\",(_wsRef$current7=wsRef.current)===null||_wsRef$current7===void 0?void 0:_wsRef$current7.readyState);console.log(\"- URL:\",(_wsRef$current8=wsRef.current)===null||_wsRef$current8===void 0?void 0:_wsRef$current8.url);setError(\"WebSocket Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");setIsConnecting(false);};}catch(err){console.error(\"üí• WebSocket ÏÉùÏÑ± Ïã§Ìå®:\",err);setError(\"WebSocket Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: \"+err.message);setIsConnecting(false);}},[getWebSocketUrl]);// WebSocket Ïó∞Í≤∞ Ìï¥Ï†ú\nconst disconnect=useCallback(()=>{if(reconnectTimeoutRef.current){clearTimeout(reconnectTimeoutRef.current);reconnectTimeoutRef.current=null;}if(wsRef.current){wsRef.current.close(1000,\"Manual disconnect\");wsRef.current=null;}setIsConnected(false);setIsConnecting(false);reconnectAttempts.current=0;},[]);// Î©îÏãúÏßÄ Ï†ÑÏÜ°\nconst sendMessage=useCallback(message=>{var _wsRef$current9;if(((_wsRef$current9=wsRef.current)===null||_wsRef$current9===void 0?void 0:_wsRef$current9.readyState)===WebSocket.OPEN){wsRef.current.send(JSON.stringify(message));return true;}else{console.error(\"WebSocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§\");setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");return false;}},[]);// Ïä§Ìä∏Î¶¨Î∞ç ÏöîÏ≤≠\nconst startStreaming=useCallback(function(userInput){let chatHistory=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let promptCards=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let modelId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!isConnected){setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");return false;}const message={action:\"stream\",projectId,userInput,chat_history:chatHistory,prompt_cards:promptCards,modelId:modelId};console.log('WebSocket Î©îÏãúÏßÄ Ï†ÑÏÜ°:',{action:message.action,projectId:message.projectId,inputLength:userInput.length,historyLength:chatHistory.length,promptCardsCount:promptCards.length});return sendMessage(message);},[isConnected,projectId,sendMessage]);// Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Îì±Î°ù\nconst addMessageListener=useCallback(listener=>{if(wsRef.current){wsRef.current.addEventListener(\"message\",listener);}},[]);// Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Ï†úÍ±∞\nconst removeMessageListener=useCallback(listener=>{if(wsRef.current){wsRef.current.removeEventListener(\"message\",listener);}},[]);// Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ïó∞Í≤∞, Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Ìï¥Ï†ú\nuseEffect(()=>{// Ï¥àÍ∏∞ Ïó∞Í≤∞ ÏßÄÏó∞ÏùÑ ÌÜµÌï¥ React strict mode Ïù¥Ïäà ÌöåÌîº\nconst timer=setTimeout(()=>{connect();},100);return()=>{clearTimeout(timer);disconnect();};},[]);// ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥ÏùÑ Îπà Î∞∞Ïó¥Î°ú Î≥ÄÍ≤Ω\n// projectId Î≥ÄÍ≤Ω Ïãú Ïû¨Ïó∞Í≤∞\nuseEffect(()=>{if(isConnected&&projectId){console.log('ProjectId Î≥ÄÍ≤ΩÎê®, Ïû¨Ïó∞Í≤∞ Ï§ë:',projectId);disconnect();setTimeout(connect,200);}},[projectId]);// connect, disconnect ÏùòÏ°¥ÏÑ± Ï†úÍ±∞\nreturn{isConnected,isConnecting,error,connect,disconnect,sendMessage,startStreaming,addMessageListener,removeMessageListener};};","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","useWebSocket","projectId","isConnected","setIsConnected","isConnecting","setIsConnecting","error","setError","wsRef","reconnectTimeoutRef","reconnectAttempts","maxReconnectAttempts","getWebSocketUrl","wsUrl","process","env","REACT_APP_WS_URL","startsWith","console","normalizedUrl","replace","log","connect","_wsRef$current","_wsRef$current2","current","readyState","WebSocket","OPEN","CONNECTING","close","window","wsConnectStart","Date","now","connectionTimeout","setTimeout","_wsRef$current3","onopen","event","_wsRef$current4","_wsRef$current5","_wsRef$current6","clearTimeout","url","protocol","extensions","onclose","connectionDuration","code","reason","wasClean","errorMessage","delay","Math","min","pow","onerror","_wsRef$current7","_wsRef$current8","err","message","disconnect","sendMessage","_wsRef$current9","send","JSON","stringify","startStreaming","userInput","chatHistory","arguments","length","undefined","promptCards","modelId","action","chat_history","prompt_cards","inputLength","historyLength","promptCardsCount","addMessageListener","listener","addEventListener","removeMessageListener","removeEventListener","timer"],"sources":["/Users/yeong-gwang/Documents/work/·Ñâ·Ö•·Ñã·ÖÆ·ÜØ·ÑÄ·Öß·Üº·Ñå·Ö¶·Ñâ·Öµ·Ü´·ÑÜ·ÖÆ·Ü´/ai_·Ñå·Ö¶·ÑÜ·Ö©·Ü®·ÑÉ·Ö°·ÜØ·ÑÄ·Öµ(·Ñâ·ÖÆ)_·Ñã·Ö™·Ü´·Ñâ·Ö•·Üº·Ñá·Ö©·Ü´_·Ñâ·Ö≥·Ñê·Ö≥·ÑÖ·Öµ·ÑÜ·Öµ·Üº·ÑÄ·ÖÆ·Ñí·Öß·Ü´ ·Ñá·Ö©·Ü®·Ñâ·Ö°·Ñá·Ö©·Ü´/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useRef, useCallback } from \"react\";\n\n/**\n * WebSocket Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞çÏùÑ ÏúÑÌïú Ïª§Ïä§ÌÖÄ ÌõÖ\n */\nexport const useWebSocket = (projectId) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  // WebSocket URL (ÌôòÍ≤ΩÎ≥ÄÏàòÎÇò Ïã§Ï†ú Î∞∞Ìè¨Îêú URLÎ°ú ÏÑ§Ï†ï)\n  const getWebSocketUrl = useCallback(() => {\n    const wsUrl =\n      process.env.REACT_APP_WS_URL ||\n      \"wss://na17isxiri.execute-api.us-east-1.amazonaws.com/prod\";\n    \n    // URL ÌòïÏãù Í≤ÄÏ¶ù Î∞è Ï†ïÍ∑úÌôî\n    if (!wsUrl.startsWith(\"wss://\") && !wsUrl.startsWith(\"ws://\")) {\n      console.error(\"ÏûòÎ™ªÎêú WebSocket URL ÌòïÏãù:\", wsUrl);\n      return null;\n    }\n    \n    // ÎÅùÏóê Ïä¨ÎûòÏãú Ï†úÍ±∞\n    const normalizedUrl = wsUrl.replace(/\\/$/, \"\");\n    console.log(\"WebSocket URL ÌôïÏù∏:\", normalizedUrl);\n    console.log(\"ÌôòÍ≤ΩÎ≥ÄÏàò REACT_APP_WS_URL:\", process.env.REACT_APP_WS_URL);\n    \n    return normalizedUrl;\n  }, []);\n\n  // WebSocket Ïó∞Í≤∞\n  const connect = useCallback(() => {\n    // Ïù¥ÎØ∏ Ïó∞Í≤∞ Ï§ëÏù¥Í±∞ÎÇò Ïó∞Í≤∞Îêú Í≤ΩÏö∞ Ï§ëÎ≥µ Ïó∞Í≤∞ Î∞©ÏßÄ\n    if (wsRef.current?.readyState === WebSocket.OPEN || \n        wsRef.current?.readyState === WebSocket.CONNECTING) {\n      console.log(\"Ïù¥ÎØ∏ Ïó∞Í≤∞Îêú WebSocketÏù¥ ÏûàÏäµÎãàÎã§ (readyState:\", wsRef.current.readyState, \")\");\n      return;\n    }\n\n    // Ïù¥Ï†Ñ Ïó∞Í≤∞Ïù¥ ÏûàÎã§Î©¥ Ï†ïÎ¶¨\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    setIsConnecting(true);\n    setError(null);\n\n    try {\n      const wsUrl = getWebSocketUrl();\n      \n      if (!wsUrl) {\n        setError(\"Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ WebSocket URL\");\n        setIsConnecting(false);\n        return;\n      }\n\n      console.log(\"WebSocket Ïó∞Í≤∞ ÏãúÎèÑ:\", wsUrl);\n      console.log(\"Î∏åÎùºÏö∞Ï†Ä WebSocket ÏßÄÏõê:\", !!window.WebSocket);\n\n      // Ïó∞Í≤∞ ÏãúÎèÑ ÏãúÍ∞Ñ Í∏∞Î°ù\n      window.wsConnectStart = Date.now();\n\n      wsRef.current = new WebSocket(wsUrl);\n\n      // Ïó∞Í≤∞ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ\n      const connectionTimeout = setTimeout(() => {\n        if (wsRef.current?.readyState === WebSocket.CONNECTING) {\n          console.error(\"WebSocket Ïó∞Í≤∞ ÏãúÍ∞Ñ Ï¥àÍ≥º\");\n          wsRef.current.close();\n          setError(\"Ïó∞Í≤∞ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§\");\n          setIsConnecting(false);\n        }\n      }, 10000); // 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ\n\n      wsRef.current.onopen = (event) => {\n        clearTimeout(connectionTimeout);\n        console.log(\"üü¢ WebSocket Ïó∞Í≤∞ ÏÑ±Í≥µ!\");\n        console.log(\"- Event:\", event);\n        console.log(\"- URL:\", wsRef.current?.url);\n        console.log(\"- Protocol:\", wsRef.current?.protocol);\n        console.log(\"- Extensions:\", wsRef.current?.extensions);\n        setIsConnected(true);\n        setIsConnecting(false);\n        setError(null);\n        reconnectAttempts.current = 0;\n      };\n\n      wsRef.current.onclose = (event) => {\n        clearTimeout(connectionTimeout);\n        const connectionDuration = Date.now() - (window.wsConnectStart || 0);\n        \n        console.log(\"üî¥ WebSocket Ïó∞Í≤∞ Ï¢ÖÎ£å:\");\n        console.log(\"- Code:\", event.code);\n        console.log(\"- Reason:\", event.reason || \"(no reason provided)\");\n        console.log(\"- WasClean:\", event.wasClean);\n        console.log(\"- Connection duration:\", connectionDuration + \"ms\");\n        \n        setIsConnected(false);\n        setIsConnecting(false);\n\n        // Ï¶âÏãú Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ (500ms Ïù¥ÎÇ¥) - ÏÑúÎ≤Ñ Î¨∏Ï†ú\n        if (connectionDuration < 500) {\n          console.error(\"‚ö†Ô∏è WebSocketÏù¥ Ï¶âÏãú Ï¢ÖÎ£åÎê® - ÏÑúÎ≤Ñ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±\");\n          \n          // ÌäπÏ†ï ÏóêÎü¨ ÏΩîÎìúÏóê Îî∞Î•∏ ÏÑ∏Î∂ÑÌôîÎêú ÏóêÎü¨ Î©îÏãúÏßÄ\n          let errorMessage = \"ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\";\n          switch(event.code) {\n            case 1006:\n              errorMessage = \"ÎπÑÏ†ïÏÉÅÏ†ÅÏù∏ Ïó∞Í≤∞ Ï¢ÖÎ£å (ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±)\";\n              break;\n            case 1002:\n              errorMessage = \"ÌîÑÎ°úÌÜ†ÏΩú Ïò§Î•ò\";\n              break;\n            case 1003:\n              errorMessage = \"ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ\";\n              break;\n            case 1011:\n              errorMessage = \"ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•ò\";\n              break;\n          }\n          \n          setError(errorMessage);\n          return;\n        }\n\n        // ÏûêÎèô Ïû¨Ïó∞Í≤∞ (Ï†ïÏÉÅ Ï¢ÖÎ£åÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞)\n        if (\n          event.code !== 1000 &&\n          reconnectAttempts.current < maxReconnectAttempts\n        ) {\n          const delay = Math.min(\n            1000 * Math.pow(2, reconnectAttempts.current),\n            30000\n          );\n          console.log(\n            `üîÑ ${delay}ms ÌõÑ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ (${\n              reconnectAttempts.current + 1\n            }/${maxReconnectAttempts})`\n          );\n\n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttempts.current++;\n            connect();\n          }, delay);\n        } else if (reconnectAttempts.current >= maxReconnectAttempts) {\n          setError(\"ÏµúÎåÄ Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ÌöüÏàòÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§.\");\n        }\n      };\n\n      wsRef.current.onerror = (error) => {\n        clearTimeout(connectionTimeout);\n        console.error(\"üí• WebSocket Ïò§Î•ò:\", error);\n        console.log(\"- ReadyState:\", wsRef.current?.readyState);\n        console.log(\"- URL:\", wsRef.current?.url);\n        setError(\"WebSocket Ïó∞Í≤∞ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§\");\n        setIsConnecting(false);\n      };\n\n    } catch (err) {\n      console.error(\"üí• WebSocket ÏÉùÏÑ± Ïã§Ìå®:\", err);\n      setError(\"WebSocket Ïó∞Í≤∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: \" + err.message);\n      setIsConnecting(false);\n    }\n  }, [getWebSocketUrl]);\n\n  // WebSocket Ïó∞Í≤∞ Ìï¥Ï†ú\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n\n    if (wsRef.current) {\n      wsRef.current.close(1000, \"Manual disconnect\");\n      wsRef.current = null;\n    }\n\n    setIsConnected(false);\n    setIsConnecting(false);\n    reconnectAttempts.current = 0;\n  }, []);\n\n  // Î©îÏãúÏßÄ Ï†ÑÏÜ°\n  const sendMessage = useCallback((message) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n      return true;\n    } else {\n      console.error(\"WebSocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§\");\n      setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n      return false;\n    }\n  }, []);\n\n  // Ïä§Ìä∏Î¶¨Î∞ç ÏöîÏ≤≠\n  const startStreaming = useCallback(\n    (userInput, chatHistory = [], promptCards = [], modelId = null) => {\n      if (!isConnected) {\n        setError(\"WebSocket Ïó∞Í≤∞Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§\");\n        return false;\n      }\n\n      const message = {\n        action: \"stream\",\n        projectId,\n        userInput,\n        chat_history: chatHistory,\n        prompt_cards: promptCards,\n        modelId: modelId,\n      };\n\n      console.log('WebSocket Î©îÏãúÏßÄ Ï†ÑÏÜ°:', {\n        action: message.action,\n        projectId: message.projectId,\n        inputLength: userInput.length,\n        historyLength: chatHistory.length,\n        promptCardsCount: promptCards.length\n      });\n\n      return sendMessage(message);\n    },\n    [isConnected, projectId, sendMessage]\n  );\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Îì±Î°ù\n  const addMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.addEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Î©îÏãúÏßÄ Î¶¨Ïä§ÎÑà Ï†úÍ±∞\n  const removeMessageListener = useCallback((listener) => {\n    if (wsRef.current) {\n      wsRef.current.removeEventListener(\"message\", listener);\n    }\n  }, []);\n\n  // Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ïó∞Í≤∞, Ïñ∏ÎßàÏö¥Ìä∏ Ïãú Ìï¥Ï†ú\n  useEffect(() => {\n    // Ï¥àÍ∏∞ Ïó∞Í≤∞ ÏßÄÏó∞ÏùÑ ÌÜµÌï¥ React strict mode Ïù¥Ïäà ÌöåÌîº\n    const timer = setTimeout(() => {\n      connect();\n    }, 100);\n    \n    return () => {\n      clearTimeout(timer);\n      disconnect();\n    };\n  }, []); // ÏùòÏ°¥ÏÑ± Î∞∞Ïó¥ÏùÑ Îπà Î∞∞Ïó¥Î°ú Î≥ÄÍ≤Ω\n\n  // projectId Î≥ÄÍ≤Ω Ïãú Ïû¨Ïó∞Í≤∞\n  useEffect(() => {\n    if (isConnected && projectId) {\n      console.log('ProjectId Î≥ÄÍ≤ΩÎê®, Ïû¨Ïó∞Í≤∞ Ï§ë:', projectId);\n      disconnect();\n      setTimeout(connect, 200);\n    }\n  }, [projectId]); // connect, disconnect ÏùòÏ°¥ÏÑ± Ï†úÍ±∞\n\n  return {\n    isConnected,\n    isConnecting,\n    error,\n    connect,\n    disconnect,\n    sendMessage,\n    startStreaming,\n    addMessageListener,\n    removeMessageListener,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}