{"ast":null,"code":"import { Amplify } from '@aws-amplify/core';\nimport { assertTokenProviderConfig, assertOAuthConfig, urlSafeEncode, isBrowser, AuthAction } from '@aws-amplify/core/internals/utils';\nimport '../utils/oauth/enableOAuthListener.mjs';\nimport { cognitoHostedUIIdentityProviderMap } from '../types/models.mjs';\nimport { getAuthUserAgentValue } from '../../../utils/getAuthUserAgentValue.mjs';\nimport { openAuthSession } from '../../../utils/openAuthSession.mjs';\nimport { assertUserNotAuthenticated } from '../utils/signInHelpers.mjs';\nimport { generateCodeVerifier } from '../utils/oauth/generateCodeVerifier.mjs';\nimport { generateState } from '../utils/oauth/generateState.mjs';\nimport '../utils/refreshAuthTokens.mjs';\nimport '../tokenProvider/errorHelpers.mjs';\nimport { oAuthStore } from '../utils/oauth/oAuthStore.mjs';\nimport '../tokenProvider/tokenProvider.mjs';\nimport { getRedirectUrl } from '../utils/oauth/getRedirectUrl.mjs';\nimport { handleFailure } from '../utils/oauth/handleFailure.mjs';\nimport { completeOAuthFlow } from '../utils/oauth/completeOAuthFlow.mjs';\nimport '../../../types/Auth.mjs';\nimport { createOAuthError } from '../utils/oauth/createOAuthError.mjs';\nimport { listenForOAuthFlowCancellation } from '../utils/oauth/cancelOAuthFlow.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Signs in a user with OAuth. Redirects the application to an Identity Provider.\n *\n * @param input - The SignInWithRedirectInput object, if empty it will redirect to Cognito HostedUI\n *\n * @throws AuthTokenConfigException - Thrown when the user pool config is invalid.\n * @throws OAuthNotConfigureException - Thrown when the oauth config is invalid.\n */\nasync function signInWithRedirect(input) {\n  const authConfig = Amplify.getConfig().Auth?.Cognito;\n  assertTokenProviderConfig(authConfig);\n  assertOAuthConfig(authConfig);\n  oAuthStore.setAuthConfig(authConfig);\n  await assertUserNotAuthenticated();\n  let provider = 'COGNITO'; // Default\n  if (typeof input?.provider === 'string') {\n    provider = cognitoHostedUIIdentityProviderMap[input.provider];\n  } else if (input?.provider?.custom) {\n    provider = input.provider.custom;\n  }\n  return oauthSignIn({\n    oauthConfig: authConfig.loginWith.oauth,\n    clientId: authConfig.userPoolClientId,\n    provider,\n    customState: input?.customState,\n    preferPrivateSession: input?.options?.preferPrivateSession,\n    options: {\n      loginHint: input?.options?.loginHint,\n      lang: input?.options?.lang,\n      nonce: input?.options?.nonce\n    }\n  });\n}\nconst oauthSignIn = async _ref => {\n  let {\n    oauthConfig,\n    provider,\n    clientId,\n    customState,\n    preferPrivateSession,\n    options\n  } = _ref;\n  const {\n    domain,\n    redirectSignIn,\n    responseType,\n    scopes\n  } = oauthConfig;\n  const {\n    loginHint,\n    lang,\n    nonce\n  } = options ?? {};\n  const randomState = generateState();\n  /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n  single-encodes/decodes url on first sign in and double-encodes/decodes url\n  when user already signed in. Using encodeURIComponent, Base32, Base64 add\n  characters % or = which on further encoding becomes unsafe. '=' create issue\n  for parsing query params.\n  Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n  const state = customState ? `${randomState}-${urlSafeEncode(customState)}` : randomState;\n  const {\n    value,\n    method,\n    toCodeChallenge\n  } = generateCodeVerifier(128);\n  const redirectUri = getRedirectUrl(oauthConfig.redirectSignIn);\n  if (isBrowser()) oAuthStore.storeOAuthInFlight(true);\n  oAuthStore.storeOAuthState(state);\n  oAuthStore.storePKCE(value);\n  const queryString = Object.entries({\n    redirect_uri: redirectUri,\n    response_type: responseType,\n    client_id: clientId,\n    identity_provider: provider,\n    scope: scopes.join(' '),\n    // eslint-disable-next-line camelcase\n    ...(loginHint && {\n      login_hint: loginHint\n    }),\n    ...(lang && {\n      lang\n    }),\n    ...(nonce && {\n      nonce\n    }),\n    state,\n    ...(responseType === 'code' && {\n      code_challenge: toCodeChallenge(),\n      code_challenge_method: method\n    })\n  }).map(_ref2 => {\n    let [k, v] = _ref2;\n    return `${encodeURIComponent(k)}=${encodeURIComponent(v)}`;\n  }).join('&');\n  // TODO(v6): use URL object instead\n  const oAuthUrl = `https://${domain}/oauth2/authorize?${queryString}`;\n  // this will only take effect in the following scenarios:\n  // 1. the user cancels the OAuth flow on web via back button, and\n  // 2. when bfcache is enabled\n  listenForOAuthFlowCancellation(oAuthStore);\n  // the following is effective only in react-native as openAuthSession resolves only in react-native\n  const {\n    type,\n    error,\n    url\n  } = (await openAuthSession(oAuthUrl)) ?? {};\n  try {\n    if (type === 'error') {\n      throw createOAuthError(String(error));\n    }\n    if (type === 'success' && url) {\n      await completeOAuthFlow({\n        currentUrl: url,\n        clientId,\n        domain,\n        redirectUri,\n        responseType,\n        userAgentValue: getAuthUserAgentValue(AuthAction.SignInWithRedirect),\n        preferPrivateSession\n      });\n    }\n  } catch (err) {\n    await handleFailure(err);\n    // rethrow the error so it can be caught by `await signInWithRedirect()` in react-native\n    throw err;\n  }\n};\nexport { signInWithRedirect };","map":{"version":3,"names":["signInWithRedirect","input","authConfig","Amplify","getConfig","Auth","Cognito","assertTokenProviderConfig","assertOAuthConfig","oAuthStore","setAuthConfig","assertUserNotAuthenticated","provider","cognitoHostedUIIdentityProviderMap","custom","oauthSignIn","oauthConfig","loginWith","oauth","clientId","userPoolClientId","customState","preferPrivateSession","options","loginHint","lang","nonce","_ref","domain","redirectSignIn","responseType","scopes","randomState","generateState","state","urlSafeEncode","value","method","toCodeChallenge","generateCodeVerifier","redirectUri","getRedirectUrl","isBrowser","storeOAuthInFlight","storeOAuthState","storePKCE","queryString","Object","entries","redirect_uri","response_type","client_id","identity_provider","scope","join","login_hint","code_challenge","code_challenge_method","map","_ref2","k","v","encodeURIComponent","oAuthUrl","listenForOAuthFlowCancellation","type","error","url","openAuthSession","createOAuthError","String","completeOAuthFlow","currentUrl","userAgentValue","getAuthUserAgentValue","AuthAction","SignInWithRedirect","err","handleFailure"],"sources":["/Users/yeong-gwang/Documents/work/서울경제신문/dev/nexus/title_generator_ver1/frontend/node_modules/@aws-amplify/auth/src/providers/cognito/apis/signInWithRedirect.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { Amplify } from '@aws-amplify/core';\nimport { AuthAction, assertOAuthConfig, assertTokenProviderConfig, isBrowser, urlSafeEncode, } from '@aws-amplify/core/internals/utils';\nimport '../utils/oauth/enableOAuthListener';\nimport { cognitoHostedUIIdentityProviderMap } from '../types/models';\nimport { getAuthUserAgentValue, openAuthSession } from '../../../utils';\nimport { assertUserNotAuthenticated } from '../utils/signInHelpers';\nimport { completeOAuthFlow, generateCodeVerifier, generateState, getRedirectUrl, handleFailure, oAuthStore, } from '../utils/oauth';\nimport { createOAuthError } from '../utils/oauth/createOAuthError';\nimport { listenForOAuthFlowCancellation } from '../utils/oauth/cancelOAuthFlow';\n/**\n * Signs in a user with OAuth. Redirects the application to an Identity Provider.\n *\n * @param input - The SignInWithRedirectInput object, if empty it will redirect to Cognito HostedUI\n *\n * @throws AuthTokenConfigException - Thrown when the user pool config is invalid.\n * @throws OAuthNotConfigureException - Thrown when the oauth config is invalid.\n */\nexport async function signInWithRedirect(input) {\n    const authConfig = Amplify.getConfig().Auth?.Cognito;\n    assertTokenProviderConfig(authConfig);\n    assertOAuthConfig(authConfig);\n    oAuthStore.setAuthConfig(authConfig);\n    await assertUserNotAuthenticated();\n    let provider = 'COGNITO'; // Default\n    if (typeof input?.provider === 'string') {\n        provider = cognitoHostedUIIdentityProviderMap[input.provider];\n    }\n    else if (input?.provider?.custom) {\n        provider = input.provider.custom;\n    }\n    return oauthSignIn({\n        oauthConfig: authConfig.loginWith.oauth,\n        clientId: authConfig.userPoolClientId,\n        provider,\n        customState: input?.customState,\n        preferPrivateSession: input?.options?.preferPrivateSession,\n        options: {\n            loginHint: input?.options?.loginHint,\n            lang: input?.options?.lang,\n            nonce: input?.options?.nonce,\n        },\n    });\n}\nconst oauthSignIn = async ({ oauthConfig, provider, clientId, customState, preferPrivateSession, options, }) => {\n    const { domain, redirectSignIn, responseType, scopes } = oauthConfig;\n    const { loginHint, lang, nonce } = options ?? {};\n    const randomState = generateState();\n    /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n    single-encodes/decodes url on first sign in and double-encodes/decodes url\n    when user already signed in. Using encodeURIComponent, Base32, Base64 add\n    characters % or = which on further encoding becomes unsafe. '=' create issue\n    for parsing query params.\n    Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n    const state = customState\n        ? `${randomState}-${urlSafeEncode(customState)}`\n        : randomState;\n    const { value, method, toCodeChallenge } = generateCodeVerifier(128);\n    const redirectUri = getRedirectUrl(oauthConfig.redirectSignIn);\n    if (isBrowser())\n        oAuthStore.storeOAuthInFlight(true);\n    oAuthStore.storeOAuthState(state);\n    oAuthStore.storePKCE(value);\n    const queryString = Object.entries({\n        redirect_uri: redirectUri,\n        response_type: responseType,\n        client_id: clientId,\n        identity_provider: provider,\n        scope: scopes.join(' '),\n        // eslint-disable-next-line camelcase\n        ...(loginHint && { login_hint: loginHint }),\n        ...(lang && { lang }),\n        ...(nonce && { nonce }),\n        state,\n        ...(responseType === 'code' && {\n            code_challenge: toCodeChallenge(),\n            code_challenge_method: method,\n        }),\n    })\n        .map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n        .join('&');\n    // TODO(v6): use URL object instead\n    const oAuthUrl = `https://${domain}/oauth2/authorize?${queryString}`;\n    // this will only take effect in the following scenarios:\n    // 1. the user cancels the OAuth flow on web via back button, and\n    // 2. when bfcache is enabled\n    listenForOAuthFlowCancellation(oAuthStore);\n    // the following is effective only in react-native as openAuthSession resolves only in react-native\n    const { type, error, url } = (await openAuthSession(oAuthUrl, redirectSignIn, preferPrivateSession)) ??\n        {};\n    try {\n        if (type === 'error') {\n            throw createOAuthError(String(error));\n        }\n        if (type === 'success' && url) {\n            await completeOAuthFlow({\n                currentUrl: url,\n                clientId,\n                domain,\n                redirectUri,\n                responseType,\n                userAgentValue: getAuthUserAgentValue(AuthAction.SignInWithRedirect),\n                preferPrivateSession,\n            });\n        }\n    }\n    catch (err) {\n        await handleFailure(err);\n        // rethrow the error so it can be caught by `await signInWithRedirect()` in react-native\n        throw err;\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}